{% comment %}
  Minimal GA4 consent banner. Displays until user accepts or declines.
  Requires GA4 head snippet already loaded (gtag function present).
{% endcomment %}

<div id="ga-consent-banner" style="display:none; position:fixed; bottom:0; left:0; right:0; background:#f8f9fa; border-top:1px solid #ddd; padding:12px; z-index:1000;">
  <div class="container d-flex justify-content-between align-items-center">
    <span>We use Google Analytics to improve content. Do you accept?</span>
    <div>
      <button id="ga-consent-accept" class="btn btn-sm btn-primary" aria-label="Accept analytics tracking">Accept</button>
      <button id="ga-consent-decline" class="btn btn-sm btn-secondary" aria-label="Decline analytics tracking">Decline</button>
    </div>
  </div>
  <div class="container mt-2" style="font-size: 0.875rem;">
    <span>You can change this choice anytime by clearing site data.</span>
  </div>
</div>

<script>
  (function(){
    if (typeof gtag !== 'function') { return; }
    var key='ga-consent';
    var stored=localStorage.getItem(key);
    function enableGA(){
      gtag('consent','update',{analytics_storage:'granted'});
      gtag('config', '{{ site.google_analytics }}', { anonymize_ip: true, page_path: '{{ page.url }}' });
    }
    function hideBanner(){ var b=document.getElementById('ga-consent-banner'); if(b) b.style.display='none'; }

    if(stored==='granted'){
      enableGA();
    } else if(stored==='denied'){
      // keep analytics disabled
    } else {
      var b=document.getElementById('ga-consent-banner');
      if(b){
        b.style.display='block';
        var acceptBtn=document.getElementById('ga-consent-accept');
        var declineBtn=document.getElementById('ga-consent-decline');
        if(acceptBtn){
          acceptBtn.addEventListener('click', function(){
            localStorage.setItem(key,'granted');
            enableGA();
            hideBanner();
          });
        }
        if(declineBtn){
          declineBtn.addEventListener('click', function(){
            localStorage.setItem(key,'denied');
            hideBanner();
          });
        }
      }
    }
  })();
</script>
